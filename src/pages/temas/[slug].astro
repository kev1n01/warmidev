---
import { changeLanguage } from "i18next";
import Layout from "@/layouts/Layout.astro";
import { getCollection } from "astro:content";
import IconLinkExternal from "@/icons/IconLinkExternal.astro";
import IconArrowUp from "@/icons/IconArrowUp.astro";

changeLanguage("es");

export async function getStaticPaths() {
    const semanas = await getCollection("semanas");
    return semanas.flatMap((semana) =>
        semana.data.temas.map((tema) => ({
            params: { slug: tema.slug },
            props: {
                tema,
            },
        })),
    );
}
const { tema } = Astro.props;
---

<Layout>
    <div class="space-y-5 py-10 text-white">
        <div class="flex justify-between items-center">
            <div class="p-2 flex gap-2 items-center">
                <a href="/temas" class="w-12 h-12 rounded-full bg-pink-500/50 flex justify-center items-center hover:scale-105 cursor-pointer">
                    <IconArrowUp className="-rotate-90 w-5 h-5" />
                </a>
                <p>{tema.titulo}</p>
            </div>
            <div
                class="text-center bg-violet-500/70 rounded-lg p-2 w-32 sm:w-60"
            >
                <p class="text-sm text-white font-semibold mb-2">TIPS</p>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-0 sm:gap-2">
            <!-- tasks -->
            <div
                class="h-[11rem] sm:h-[30rem] border-white/10 backdrop-blur-2xl col-span-2 rounded-lg w-full mb-2 sm:mb-0"
            >
                {
                    tema.tareas ? (
                        tema.tareas.map((tarea) => (
                            <details class="custom-details px-4 py-3 w-full rounded-lg border bg-white/10 border-white/20 hover:bg-white/15 backdrop-blur-lg dark:border-gray-700 transition-colors cursor-pointer relative mb-2 text-white">
                                <summary class="text-gray-white dark:text-gray-300 flex items-center justify-between list-none font-semibold">
                                    TAREA: {tarea.titulo}
                                    <svg
                                        class="w-5 h-5 transform transition-transform duration-200 group-open:rotate-90"
                                        fill="none"
                                        stroke="currentColor"
                                        viewBox="0 0 24 24"
                                    >
                                        <path
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                            stroke-width="2"
                                            d="M9 5l7 7-7 7"
                                        />
                                    </svg>
                                </summary>
                                <div class="mt-4 text-gray-50 dark:text-gray-100 bg-black/30 p-2 rounded-md">
                                    {tarea.descripcion}
                                </div>
                            </details>
                        ))
                    ) : (
                        <p class="text-gray-600 dark:text-gray-400">
                            No hay tareas
                        </p>
                    )
                }
            </div>
            <!-- Resources -->
            <div
                class="col-span-1 rounded-lg overflow-y-scroll h-[30rem] border-white/10 bg-white/20 backdrop-blur-2xl w-full "
            >
                {
                    tema.recursos ? (
                        tema.recursos.map((recurso) => (
                            <div class="p-2 flex items-center justify-between group cursor-pointer">
                                <p class="text-sm sm:text-base group-hover:text-cyan-300">
                                    {recurso.nombre}
                                </p>
                                <a
                                    href={recurso.url}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="text-cyan-200 group-hover:text-cyan-300"
                                >
                                    <IconLinkExternal className="w-5 h-5" />
                                </a>
                            </div>
                        ))
                    ) : (
                        <p class="text-gray-600 dark:text-gray-400">
                            No hay recursos
                        </p>
                    )
                }
            </div>
        </div>
    </div>
    <style>
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }

        details[open] svg {
            transform: rotate(90deg);
        }
    </style>
</Layout>
